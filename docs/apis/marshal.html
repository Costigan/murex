<h1 id="murex-development-guide"><em>murex</em> Development Guide</h1>
<h2 id="api-reference-marshal">API Reference: <code>Marshal()</code></h2>
<blockquote>
<p>Converts structured memory into a structured file format (eg for stdio)</p>
</blockquote>
<h3 id="description">Description</h3>
<p>This is a function you would write when programming a <em>murex</em> data-type. The marshal function takes in a Go (golang) <code>type</code> or <code>struct</code> and returns a byte slice of a “string” representation of that format (eg in JSON) or an error.</p>
<p>This marshaller is then registered to <em>murex</em> inside an <code>init()</code> function and <em>murex</em> builtins can use that marshaller via the <code>MarshalData()</code> API.</p>
<h3 id="usage">Usage</h3>
<p>Registering marshal (for writing builtin data-types)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">// To avoid data races, this should only happen inside func init()</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>define.Marshallers[<span class="st">&quot;json&quot;</span>] = marshal</span></code></pre></div>
<p>Using an existing marshaller (eg inside a builtin command)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">// See documentation on define.MarshalData for more details</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>b, err := define.MarshalData(p, dataType, data)</span></code></pre></div>
<h3 id="examples">Examples</h3>
<p>Defining a marshaller for a murex data-type</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">package</span> example</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">import</span> (</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="st">&quot;encoding/json&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">&quot;github.com/lmorg/murex/lang&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="st">&quot;github.com/lmorg/murex/lang/types/define&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>)</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">func</span> init() {</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="co">// Register data-type</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    define.Marshallers[<span class="st">&quot;json&quot;</span>] = marshal</span>
<span id="cb3-13"><a href="#cb3-13"></a>}</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">// Describe marshaller</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="kw">func</span> marshal(p *lang.Process, v <span class="kw">interface</span>{}) ([]<span class="dt">byte</span>, <span class="dt">error</span>) {</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="kw">if</span> p.Stdout.IsTTY() {</span>
<span id="cb3-18"><a href="#cb3-18"></a>        <span class="co">// If STDOUT is a TTY (ie not pipe, text file or other destination other</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>        <span class="co">// than a terminal) then output JSON in an indented, human readable,</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>        <span class="co">// format....</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>        <span class="kw">return</span> json.MarshalIndent(v, <span class="st">&quot;&quot;</span>, <span class="st">&quot;    &quot;</span>)</span>
<span id="cb3-22"><a href="#cb3-22"></a>    }</span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a>    <span class="co">// ....otherwise we might as well output it in a minified format</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>    <span class="kw">return</span> json.Marshal(v)</span>
<span id="cb3-26"><a href="#cb3-26"></a>}</span></code></pre></div>
<h3 id="parameters">Parameters</h3>
<ol type="1">
<li><code>*lang.Process</code>: Process’s runtime state. Typically expressed as the variable `p</li>
<li><code>interface{}</code>: data you wish to marshal</li>
</ol>
<h3 id="see-also">See Also</h3>
<ul>
<li><a href="../apis/unmarshal.md"><code>Unmarshal()</code></a>: Converts a structured file format into structured memory</li>
<li><a href="../apis/marshaldata.md"><code>define.MarshalData()</code></a>: Converts structured memory into a <em>murex</em> data-type (eg for stdio)</li>
<li><a href="../apis/unmarshaldata.md"><code>define.UnmarshalData()</code></a>: Converts a <em>murex</em> data-type into structured memory</li>
</ul>
