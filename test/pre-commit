#!/bin/sh

# To install:
# ln -sv $GOPATH/src/github.com/lmorg/murex/test/pre-commit .git/hooks/

PATH=$PATH:$GOPATH/bin
docs=docs/commands
cdocs=builtins/core/docs

cd $GOPATH/src/github.com/lmorg/murex

trap ctrl_c INT

ctrl_c() {
  printf "\n\033[0;31m[COMMIT CANCELLED]\033[0m\n"
  exit 1
}

echo "Updating auto-generated code...."
go generate ./... || exit 1

echo "Compiling docgen...."
go install github.com/lmorg/murex/utils/docgen || exit 1

echo "Compiling Murex docs...."
#rm $docs/*
docgen -verbose -config gen/docgen.yaml || exit 1

echo "Formatting autogen docs...."
go fmt $cdocs/*.go

echo "Updating git...."
find -name "*_string.go" -exec git add -v {} \;
git add -v docs $docs $cdocs

echo "Allowing git commit to proceed...."
